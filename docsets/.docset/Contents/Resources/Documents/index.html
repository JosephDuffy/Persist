<!DOCTYPE html>
<html lang="en">
  <head>
    <title>  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset='utf-8'>
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
    <script src="js/lunr.min.js" defer></script>
    <script src="js/typeahead.jquery.js" defer></script>
    <script src="js/jazzy.search.js" defer></script>
  </head>
  <body>
    <a title="  Reference"></a>
    <header>
      <div class="content-wrapper">
        <p><a href="index.html"> Docs</a> (98% documented)</p>
        <p class="header-right"><a href="https://github.com/JosephDuffy/Persist"><img src="img/gh.png" alt="GitHub"/>View on GitHub</a></p>
        <div class="header-right">
          <form role="search" action="search.json">
            <input type="text" placeholder="Search documentation" data-typeahead>
          </form>
        </div>
      </div>
    </header>
    <div class="content-wrapper">
      <p id="breadcrumbs">
        <a href="index.html"> Reference</a>
        <img id="carat" src="img/carat.png" alt=""/>
          Reference
      </p>
    </div>
    <div class="content-wrapper">
      <nav class="sidebar">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/AnyCancellable.html">AnyCancellable</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/InMemoryStorage.html">InMemoryStorage</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/ObservablePersister.html">ObservablePersister</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Persister.html">Persister</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Persister/Update.html">– Update</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Subscription.html">Subscription</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Enums.html">Enumerations</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Enums/PersistenceError.html">PersistenceError</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Extensions.html">Extensions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Extensions.html#/s:Sa">Array</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions.html#/s:SD">Dictionary</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Protocols.html">Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Protocols/Cancellable.html">Cancellable</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols.html#/s:7Persist35StorableInNSUbiquitousKeyValueStoreP">StorableInNSUbiquitousKeyValueStore</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols.html#/s:7Persist22StorableInUserDefaultsP">StorableInUserDefaults</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/Storage.html">Storage</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/Transformer.html">Transformer</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Structs.html">Structures</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Structs/AggregateTransformer.html">AggregateTransformer</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/DefaultValuePersistOption.html">DefaultValuePersistOption</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/JSONTransformer.html">JSONTransformer</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/OSUnfairLock.html">OSUnfairLock</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/OSUnfairLock/Ownership.html">– Ownership</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/PersistStorage.html">PersistStorage</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Persisted.html">Persisted</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/PropertyListTransformer.html">PropertyListTransformer</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/RawRepresentableTransformer.html">RawRepresentableTransformer</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/RawRepresentableTransformer/UntransformError.html">– UntransformError</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">
        <section>
          <section class="section">
            
            <h1 id='persist' class='heading'>Persist</h1>

<p><a href="https://github.com/JosephDuffy/Persist/actions?query=workflow%3ATests"><img src="https://github.com/JosephDuffy/Persist/workflows/Tests/badge.svg" alt="Tests"></a>
<img src="https://img.shields.io/badge/Xcode-11.7%20%7C%2012.5.1%20%7C%2013.2.1-success" alt="Supported Xcode Versions">&lt;!&mdash;xcode-version-badge-markdown&ndash;&gt;
<a href="https://codecov.io/gh/JosephDuffy/Persist"><img src="https://codecov.io/gh/JosephDuffy/Persist/branch/master/graph/badge.svg" alt="codecov"></a>
<a href="https://josephduffy.github.io/Persist/"><img src="https://josephduffy.github.io/Persist/badge.svg" alt="Documentation"></a>
<a href="https://github.com/apple/swift-package-manager"><img src="https://img.shields.io/badge/SwiftPM-compatible-4BC51D.svg?style=flat" alt="SwiftPM Compatible"></a></p>

<p><code>Persist</code> is a framework that aids with persisting and retrieving values, with support for transformations such as storing as JSON data.</p>
<h2 id='usage' class='heading'>Usage</h2>

<p>Persist provides the <code><a href="Classes/Persister.html">Persister</a></code> class, which can be used to persist and retrieve values from various forms of storage.</p>

<p>The <code><a href="Structs/Persisted.html">Persisted</a></code> property wrapper wraps a <code><a href="Classes/Persister.html">Persister</a></code>, making it easy to have a property that automatically persists its value.</p>
<pre class="highlight swift"><code><span class="kd">class</span> <span class="kt">Foo</span> <span class="p">{</span>
    <span class="kd">enum</span> <span class="kt">Bar</span><span class="p">:</span> <span class="kt">Int</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">firstBar</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">case</span> <span class="n">secondBar</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="p">}</span>

    <span class="kd">@Persisted</span><span class="p">(</span><span class="nv">key</span><span class="p">:</span> <span class="s">"foo-bar"</span><span class="p">,</span> <span class="nv">userDefaults</span><span class="p">:</span> <span class="o">.</span><span class="n">standard</span><span class="p">,</span> <span class="nv">transformer</span><span class="p">:</span> <span class="kt">RawRepresentableTransformer</span><span class="p">())</span>
    <span class="k">var</span> <span class="nv">bar</span><span class="p">:</span> <span class="kt">Bar</span> <span class="o">=</span> <span class="o">.</span><span class="n">firstBar</span>

    <span class="kd">@Persisted</span><span class="p">(</span><span class="nv">key</span><span class="p">:</span> <span class="s">"foo-baz"</span><span class="p">,</span> <span class="nv">userDefaults</span><span class="p">:</span> <span class="o">.</span><span class="n">standard</span><span class="p">)</span>
    <span class="k">var</span> <span class="nv">baz</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">foo</span> <span class="o">=</span> <span class="kt">Foo</span><span class="p">()</span>

<span class="n">foo</span><span class="o">.</span><span class="n">bar</span> <span class="c1">// "Bar.firstBar"</span>
<span class="n">foo</span><span class="o">.</span><span class="n">bar</span> <span class="o">=</span> <span class="o">.</span><span class="n">secondBar</span>
<span class="kt">UserDefaults</span><span class="o">.</span><span class="n">standard</span><span class="o">.</span><span class="nf">object</span><span class="p">(</span><span class="nv">forKey</span><span class="p">:</span> <span class="s">"foo-bar"</span><span class="p">)</span> <span class="c1">// 2</span>

<span class="n">foo</span><span class="o">.</span><span class="n">baz</span> <span class="c1">// nil</span>
<span class="n">foo</span><span class="o">.</span><span class="n">baz</span> <span class="o">=</span> <span class="s">"new-value"</span>
<span class="kt">UserDefaults</span><span class="o">.</span><span class="n">standard</span><span class="o">.</span><span class="nf">object</span><span class="p">(</span><span class="nv">forKey</span><span class="p">:</span> <span class="s">"foo-baz"</span><span class="p">)</span> <span class="c1">// "new-value"</span>
</code></pre>

<p><code>Persist</code> includes out of the box support for:</p>

<ul>
<li><code>UserDefaults</code></li>
<li><code>NSUbiquitousKeyValueStore</code></li>
<li><code>FileManager</code></li>
<li><code><a href="Classes/InMemoryStorage.html">InMemoryStorage</a></code> (a simple wrapper around a dictionary)</li>
</ul>
<h3 id='catching-errors' class='heading'>Catching Errors</h3>

<p><code><a href="Classes/Persister.html">Persister</a></code>&lsquo;s <code>persist(_:)</code> and <code>retrieveValueOrThrow()</code> functions will throw if the storage or transformer throws an error.</p>

<p><code><a href="Structs/Persisted.html">Persisted</a></code> wraps a <code><a href="Classes/Persister.html">Persister</a></code> and exposes it as the <code>projectedValue</code>, which allows you to catch errors:</p>
<pre class="highlight swift"><code><span class="kd">class</span> <span class="kt">Foo</span> <span class="p">{</span>
    <span class="kd">@Persisted</span><span class="p">(</span><span class="nv">key</span><span class="p">:</span> <span class="s">"foo-bar"</span><span class="p">,</span> <span class="nv">userDefaults</span><span class="p">:</span> <span class="o">.</span><span class="n">standard</span><span class="p">)</span>
    <span class="k">var</span> <span class="nv">bar</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span>
<span class="p">}</span>

<span class="k">do</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">foo</span> <span class="o">=</span> <span class="kt">Foo</span><span class="p">()</span>
    <span class="k">try</span> <span class="n">foo</span><span class="o">.</span><span class="err">$</span><span class="n">bar</span><span class="o">.</span><span class="nf">persist</span><span class="p">(</span><span class="s">"new-value"</span><span class="p">)</span>
    <span class="k">try</span> <span class="n">foo</span><span class="o">.</span><span class="err">$</span><span class="n">bar</span><span class="o">.</span><span class="nf">retrieveValueOrThrow</span><span class="p">()</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
    <span class="c1">// Something went wrong</span>
<span class="p">}</span>
</code></pre>
<h3 id='subscribing-to-updates' class='heading'>Subscribing to Updates</h3>

<p>When targeting macOS 10.15, iOS 13, tvOS 13, or watchOS 6 or greater Combine can be used to subscribe to updates:</p>
<pre class="highlight swift"><code><span class="kd">class</span> <span class="kt">Foo</span> <span class="p">{</span>
    <span class="kd">@Persisted</span><span class="p">(</span><span class="nv">key</span><span class="p">:</span> <span class="s">"foo-bar"</span><span class="p">,</span> <span class="nv">userDefaults</span><span class="p">:</span> <span class="o">.</span><span class="n">standard</span><span class="p">)</span>
    <span class="k">var</span> <span class="nv">bar</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">foo</span> <span class="o">=</span> <span class="kt">Foo</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">subscription</span> <span class="o">=</span> <span class="n">foo</span><span class="o">.</span><span class="err">$</span><span class="n">bar</span><span class="o">.</span><span class="n">updatesPublisher</span><span class="o">.</span><span class="n">sink</span> <span class="p">{</span> <span class="n">result</span> <span class="k">in</span>
    <span class="k">switch</span> <span class="n">result</span> <span class="p">{</span>
    <span class="k">case</span> <span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="k">let</span> <span class="nv">update</span><span class="p">):</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"New value:"</span><span class="p">,</span> <span class="n">update</span><span class="o">.</span><span class="n">newValue</span><span class="p">)</span>

        <span class="k">switch</span> <span class="n">update</span><span class="o">.</span><span class="n">event</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">.</span><span class="nf">persisted</span><span class="p">(</span><span class="k">let</span> <span class="nv">newValue</span><span class="p">):</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Value updated to:"</span><span class="p">,</span> <span class="n">newValue</span><span class="p">)</span>
            <span class="c1">// `update.newValue` will be new value</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">removed</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Value was deleted"</span><span class="p">)</span>
            <span class="c1">// `update.newValue` will be default value</span>
        <span class="p">}</span>
    <span class="k">case</span> <span class="o">.</span><span class="nf">failure</span><span class="p">(</span><span class="k">let</span> <span class="nv">error</span><span class="p">):</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Error occurred retrieving value after update:"</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>For versions prior to macOS 10.15, iOS 13, tvOS 13, or watchOS 6 a closure API is provided:</p>
<pre class="highlight swift"><code><span class="kd">class</span> <span class="kt">Foo</span> <span class="p">{</span>
    <span class="kd">@Persisted</span><span class="p">(</span><span class="nv">key</span><span class="p">:</span> <span class="s">"foo-bar"</span><span class="p">,</span> <span class="nv">userDefaults</span><span class="p">:</span> <span class="o">.</span><span class="n">standard</span><span class="p">)</span>
    <span class="k">var</span> <span class="nv">bar</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">foo</span> <span class="o">=</span> <span class="kt">Foo</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">subscription</span> <span class="o">=</span> <span class="n">foo</span><span class="o">.</span><span class="err">$</span><span class="n">bar</span><span class="o">.</span><span class="nf">addUpdateListener</span><span class="p">()</span> <span class="p">{</span> <span class="n">result</span> <span class="k">in</span>
    <span class="k">switch</span> <span class="n">result</span> <span class="p">{</span>
    <span class="k">case</span> <span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="k">let</span> <span class="nv">update</span><span class="p">):</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"New value:"</span><span class="p">,</span> <span class="n">update</span><span class="o">.</span><span class="n">newValue</span><span class="p">)</span>

        <span class="k">switch</span> <span class="n">update</span><span class="o">.</span><span class="n">event</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">.</span><span class="nf">persisted</span><span class="p">(</span><span class="k">let</span> <span class="nv">newValue</span><span class="p">):</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Value updated to:"</span><span class="p">,</span> <span class="n">newValue</span><span class="p">)</span>
            <span class="c1">// `update.newValue` will be new value</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">removed</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Value was deleted"</span><span class="p">)</span>
            <span class="c1">// `update.newValue` will be default value</span>
        <span class="p">}</span>
    <span class="k">case</span> <span class="o">.</span><span class="nf">failure</span><span class="p">(</span><span class="k">let</span> <span class="nv">error</span><span class="p">):</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Error occurred retrieving value after update:"</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<h3 id='transformers' class='heading'>Transformers</h3>

<p>Some storage methods will only support a subset of types, or you might want to modify how some values are encoded/decoded (e.g. to ensure on-disk date representation are the same as what an API sends/expects). This is where transformers come in:</p>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">Bar</span><span class="p">:</span> <span class="kt">Codable</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">baz</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="kt">Foo</span> <span class="p">{</span>
    <span class="kd">@Persisted</span><span class="p">(</span><span class="nv">key</span><span class="p">:</span> <span class="s">"bar"</span><span class="p">,</span> <span class="nv">userDefaults</span><span class="p">:</span> <span class="o">.</span><span class="n">standard</span><span class="p">,</span> <span class="nv">transformer</span><span class="p">:</span> <span class="kt">JSONTransformer</span><span class="p">())</span>
    <span class="k">var</span> <span class="nv">bar</span><span class="p">:</span> <span class="kt">Bar</span><span class="p">?</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">foo</span> <span class="o">=</span> <span class="kt">Foo</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">subscription</span> <span class="o">=</span> <span class="n">foo</span><span class="o">.</span><span class="err">$</span><span class="n">bar</span><span class="o">.</span><span class="nf">addUpdateListener</span><span class="p">()</span> <span class="p">{</span> <span class="n">result</span> <span class="k">in</span>
    <span class="k">switch</span> <span class="n">result</span> <span class="p">{</span>
    <span class="k">case</span> <span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="k">let</span> <span class="nv">update</span><span class="p">):</span>
        <span class="c1">// `update.newValue` is a `Bar?`</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"New value:"</span><span class="p">,</span> <span class="n">update</span><span class="o">.</span><span class="n">newValue</span><span class="p">)</span>

        <span class="k">switch</span> <span class="n">update</span><span class="o">.</span><span class="n">event</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">.</span><span class="nf">persisted</span><span class="p">(</span><span class="k">let</span> <span class="nv">bar</span><span class="p">):</span>
            <span class="c1">// `bar` is the decoded `Bar`</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Value updated to:"</span><span class="p">,</span> <span class="n">bar</span><span class="p">)</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">removed</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Value was deleted"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="k">case</span> <span class="o">.</span><span class="nf">failure</span><span class="p">(</span><span class="k">let</span> <span class="nv">error</span><span class="p">):</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Error occurred retrieving value after update:"</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>Transformers are typesafe, e.g. <code><a href="Structs/JSONTransformer.html">JSONTransformer</a></code> is only usable when the value to be stored is <code>Codable</code> and the <code><a href="Protocols/Storage.html">Storage</a></code> supports <code>Data</code>.</p>
<h4 id='chaining-transformers' class='heading'>Chaining Transformers</h4>

<p>If a value should go through multiple transformers you can chain them.</p>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">Bar</span><span class="p">:</span> <span class="kt">Codable</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">baz</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="kd">struct</span> <span class="kt">BarTransformer</span><span class="p">:</span> <span class="kt">Transformer</span> <span class="p">{</span>

    <span class="kd">public</span> <span class="kd">func</span> <span class="nf">transformValue</span><span class="p">(</span><span class="n">_</span> <span class="nv">bar</span><span class="p">:</span> <span class="kt">Bar</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bar</span> <span class="p">{</span>
        <span class="k">var</span> <span class="nv">bar</span> <span class="o">=</span> <span class="n">bar</span>
        <span class="n">bar</span><span class="o">.</span><span class="n">baz</span> <span class="o">=</span> <span class="s">"transformed"</span>
        <span class="k">return</span> <span class="n">bar</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kd">func</span> <span class="nf">untransformValue</span><span class="p">(</span><span class="n">_</span> <span class="nv">bar</span><span class="p">:</span> <span class="kt">Bar</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bar</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">bar</span>
    <span class="p">}</span>

<span class="p">}</span>

<span class="kd">class</span> <span class="kt">Foo</span> <span class="p">{</span>
    <span class="kd">@Persisted</span><span class="p">(</span><span class="nv">key</span><span class="p">:</span> <span class="s">"bar"</span><span class="p">,</span> <span class="nv">userDefaults</span><span class="p">:</span> <span class="o">.</span><span class="n">standard</span><span class="p">,</span> <span class="nv">transformer</span><span class="p">:</span> <span class="kt">BarTransformer</span><span class="p">()</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="kt">JSONTransformer</span><span class="p">()))</span>
    <span class="k">var</span> <span class="nv">bar</span><span class="p">:</span> <span class="kt">Bar</span><span class="p">?</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">foo</span> <span class="o">=</span> <span class="kt">Foo</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">bar</span> <span class="o">=</span> <span class="kt">Bar</span><span class="p">(</span><span class="nv">baz</span><span class="p">:</span> <span class="s">"example value"</span><span class="p">)</span>
<span class="n">foo</span><span class="o">.</span><span class="n">bar</span> <span class="o">=</span> <span class="n">bar</span>
<span class="n">foo</span><span class="o">.</span><span class="n">bar</span><span class="o">.</span><span class="n">baz</span> <span class="c1">// "transformed"</span>
</code></pre>
<h3 id='default-values' class='heading'>Default Values</h3>

<p>A default value may be provided that will be used when the persister returns <code>nil</code> or throws and error.</p>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">Foo</span> <span class="p">{</span>
    <span class="kd">@Persisted</span><span class="p">(</span><span class="nv">key</span><span class="p">:</span> <span class="s">"bar"</span><span class="p">,</span> <span class="nv">userDefaults</span><span class="p">:</span> <span class="o">.</span><span class="n">standard</span><span class="p">)</span>
    <span class="k">var</span> <span class="nv">bar</span> <span class="o">=</span> <span class="s">"default"</span>
<span class="p">}</span>

<span class="k">var</span> <span class="nv">foo</span> <span class="o">=</span> <span class="kt">Foo</span><span class="p">()</span>
<span class="n">foo</span><span class="o">.</span><span class="n">bar</span> <span class="c1">// "default"</span>
</code></pre>

<p>When provided as the <code>defaultValue</code> parameter the value is evaluated lazily when first required.</p>
<pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">makeUUID</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">UUID</span> <span class="p">{</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"Making UUID"</span><span class="p">)</span>
    <span class="k">return</span> <span class="kt">UUID</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">Foo</span> <span class="p">{</span>
    <span class="kd">@Persisted</span><span class="p">(</span><span class="nv">key</span><span class="p">:</span> <span class="s">"bar"</span><span class="p">,</span> <span class="nv">userDefaults</span><span class="p">:</span> <span class="o">.</span><span class="n">standard</span><span class="p">,</span> <span class="n">defaultValue</span><span class="p">:</span> <span class="nf">makeUUID</span><span class="p">())</span>
    <span class="k">var</span> <span class="nv">bar</span><span class="p">:</span> <span class="kt">UUID</span>
<span class="p">}</span>

<span class="cm">/**
 This would not print anything because the default value is never required.
 */</span>
<span class="k">var</span> <span class="nv">foo</span> <span class="o">=</span> <span class="kt">Foo</span><span class="p">()</span>
<span class="n">foo</span><span class="o">.</span><span class="n">bar</span> <span class="o">=</span> <span class="kt">UUID</span><span class="p">()</span>

<span class="cm">/**
 This would print "Making UUID" once.
 */</span>
<span class="k">var</span> <span class="nv">foo</span> <span class="o">=</span> <span class="kt">Foo</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">firstCall</span> <span class="o">=</span> <span class="n">foo</span><span class="o">.</span><span class="n">bar</span>
<span class="k">let</span> <span class="nv">secondCall</span> <span class="o">=</span> <span class="n">foo</span><span class="o">.</span><span class="n">bar</span>
<span class="n">firstCall</span> <span class="o">==</span> <span class="n">secondCall</span> <span class="c1">// true</span>
</code></pre>

<p>The default value can be optionally stored when used, either due to an error or because the storage returned <code>nil</code>. This can be useful when the first value is random and should be persisted between app launches once initially created.</p>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">Foo</span> <span class="p">{</span>
    <span class="kd">@Persisted</span><span class="p">(</span><span class="nv">key</span><span class="p">:</span> <span class="s">"persistedWhenNilInt"</span><span class="p">,</span> <span class="nv">userDefaults</span><span class="p">:</span> <span class="o">.</span><span class="n">standard</span><span class="p">,</span> <span class="n">defaultValue</span><span class="p">:</span> <span class="kt">Int</span><span class="o">.</span><span class="nf">random</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="mi">1</span><span class="o">...</span><span class="mi">10</span><span class="p">),</span> <span class="n">defaultValuePersistBehaviour</span><span class="p">:</span> <span class="o">.</span><span class="n">persistWhenNil</span><span class="p">)</span>
    <span class="k">var</span> <span class="nv">persistedWhenNilInt</span><span class="p">:</span> <span class="kt">Int</span><span class="o">!</span>

    <span class="kd">@Persisted</span><span class="p">(</span><span class="nv">key</span><span class="p">:</span> <span class="s">"notPersistedWhenNilInt"</span><span class="p">,</span> <span class="nv">userDefaults</span><span class="p">:</span> <span class="o">.</span><span class="n">standard</span><span class="p">,</span> <span class="n">defaultValue</span><span class="p">:</span> <span class="kt">Int</span><span class="o">.</span><span class="nf">random</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="mi">1</span><span class="o">...</span><span class="mi">10</span><span class="p">))</span>
    <span class="k">var</span> <span class="nv">notPersistedWhenNilInt</span><span class="p">:</span> <span class="kt">Int</span><span class="o">!</span>
<span class="p">}</span>

<span class="k">var</span> <span class="nv">foo</span> <span class="o">=</span> <span class="kt">Foo</span><span class="p">()</span>

<span class="kt">UserDefaults</span><span class="o">.</span><span class="n">standard</span><span class="o">.</span><span class="nf">object</span><span class="p">(</span><span class="nv">forKey</span><span class="p">:</span> <span class="s">"persistedWhenNilInt"</span><span class="p">)</span> <span class="c1">// nil</span>
<span class="n">foo</span><span class="o">.</span><span class="n">persistedWhenNilInt</span> <span class="c1">// 3</span>
<span class="kt">UserDefaults</span><span class="o">.</span><span class="n">standard</span><span class="o">.</span><span class="nf">object</span><span class="p">(</span><span class="nv">forKey</span><span class="p">:</span> <span class="s">"persistedWhenNilInt"</span><span class="p">)</span> <span class="c1">// 3</span>
<span class="n">foo</span><span class="o">.</span><span class="n">persistedWhenNilInt</span> <span class="c1">// 3</span>

<span class="kt">UserDefaults</span><span class="o">.</span><span class="n">standard</span><span class="o">.</span><span class="nf">object</span><span class="p">(</span><span class="nv">forKey</span><span class="p">:</span> <span class="s">"notPersistedWhenNilInt"</span><span class="p">)</span> <span class="c1">// nil</span>
<span class="n">foo</span><span class="o">.</span><span class="n">notPersistedWhenNilInt</span> <span class="c1">// 7</span>
<span class="kt">UserDefaults</span><span class="o">.</span><span class="n">standard</span><span class="o">.</span><span class="nf">object</span><span class="p">(</span><span class="nv">forKey</span><span class="p">:</span> <span class="s">"notPersistedWhenNilInt"</span><span class="p">)</span> <span class="c1">// nil</span>
<span class="n">foo</span><span class="o">.</span><span class="n">notPersistedWhenNilInt</span> <span class="c1">// 7</span>

<span class="c1">// ...restart app</span>

<span class="kt">UserDefaults</span><span class="o">.</span><span class="n">standard</span><span class="o">.</span><span class="nf">object</span><span class="p">(</span><span class="nv">forKey</span><span class="p">:</span> <span class="s">"persistedWhenNilInt"</span><span class="p">)</span> <span class="c1">// 3</span>
<span class="n">foo</span><span class="o">.</span><span class="n">persistedWhenNilInt</span> <span class="c1">// 3</span>

<span class="kt">UserDefaults</span><span class="o">.</span><span class="n">standard</span><span class="o">.</span><span class="nf">object</span><span class="p">(</span><span class="nv">forKey</span><span class="p">:</span> <span class="s">"notPersistedWhenNilInt"</span><span class="p">)</span> <span class="c1">// nil</span>
<span class="n">foo</span><span class="o">.</span><span class="n">notPersistedWhenNilInt</span> <span class="c1">// 4</span>
</code></pre>
<h3 id='property-wrapper-initialisation' class='heading'>Property Wrapper Initialisation</h3>

<p>To support dependency injection or to initialise more complex <code><a href="Structs/Persisted.html">Persisted</a></code> instances you may initialise the property wrapper in your own init functions:</p>
<pre class="highlight swift"><code><span class="kd">class</span> <span class="kt">Foo</span> <span class="p">{</span>
    <span class="kd">@Persisted</span>
    <span class="k">var</span> <span class="nv">bar</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span>

    <span class="nf">init</span><span class="p">(</span><span class="nv">userDefaults</span><span class="p">:</span> <span class="kt">UserDefaults</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">_bar</span> <span class="o">=</span> <span class="kt">Persisted</span><span class="p">(</span><span class="nv">key</span><span class="p">:</span> <span class="s">"foo-bar"</span><span class="p">,</span> <span class="nv">userDefaults</span><span class="p">:</span> <span class="n">userDefaults</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<h2 id='installation' class='heading'>Installation</h2>

<p>Persist can be installed via <a href="https://github.com/apple/swift-package-manager">SwiftPM</a> by adding the package to the dependencies section and as the dependency of a target:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">package</span> <span class="o">=</span> <span class="kt">Package</span><span class="p">(</span>
    <span class="o">...</span>
    <span class="nv">dependencies</span><span class="p">:</span> <span class="p">[</span>
        <span class="o">.</span><span class="nf">package</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="s">"https://github.com/JosephDuffy/Persist.git"</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="s">"1.0.0"</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="nv">targets</span><span class="p">:</span> <span class="p">[</span>
        <span class="o">.</span><span class="nf">target</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="s">"MyApp"</span><span class="p">,</span> <span class="nv">dependencies</span><span class="p">:</span> <span class="p">[</span><span class="s">"Persist"</span><span class="p">]),</span>
    <span class="p">],</span>
    <span class="o">...</span>
<span class="p">)</span>
</code></pre>
<h1 id='license' class='heading'>License</h1>

<p>The project is released under the MIT license. View the <a href="./LICENSE">LICENSE</a> file for the full license.</p>

          </section>
        </section>
        <section id="footer">
          <p>&copy; 2023 <a class="link" href="" target="_blank" rel="external noopener">Joseph Duffy</a>. All rights reserved. (Last updated: 2023-01-26)</p>
          <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external noopener">jazzy ♪♫ v0.14.3</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external noopener">Realm</a> project.</p>
        </section>
      </article>
    </div>
  </body>
</html>
